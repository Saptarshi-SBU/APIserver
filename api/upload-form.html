<!DOCTYPE html>
<html>
<head>
<style>
img { 
    width: 50%; 
}
.marginauto {
    margin: 20px auto 20px;
    display: block;
}
label {
    font-size: 32px;
}

</style>
</head>

<form id='file-catcher'>
  <div>
    <img class=marginauto src="http://localhost:4040/api/v1/welcome" alt=centered style=width:1080;height:1080;
     image/>
  </div>

  <div  align="center"> 
    <label for="filename"> Select </label>
    <input id='file-input' name='filename' type='file' style ="font-size: 32px;" multiple/>
  </div>

  <br> </br>

  <div  align="center">
    <label for="tag">Description </label>
    <input id='tag-input'  name='tag' type='text' style ="font-size: 32px;" > </input>
  </div>

  <br> </br>

  <div  align="center">  <label for="upload"> Upload </label>
    <button id='upload-button' type='submit'  name="upload"   style="height: 40px; width: 120px; font-size: 32px;">
    Submit
    </button>
    <input id="action" type="button" value="Reset" onclick="run_reset()" style ="font-size: 32px" ></input>
  </div>

  <div> <progress class=marginauto id="progressBar" value="0" max="100" style="width:250px;"></progress>
  </div>

</form>

<script type="text/javascript">
  function run_reset() {
    var uploadButton = document.getElementById('upload-button');
    var pBar = document.getElementById('progressBar');
    uploadButton.textContent = "Submit"
    pBar.value = Math.round(0);
  }
</script>  

<script>
(function () {
  var fileInput = document.getElementById('file-input');
  var filetag = document.getElementById('tag-input');
  var fileCatcher = document.getElementById('file-catcher');
  var uploadButton = document.getElementById('upload-button');
  var pBar = document.getElementById('progressBar');
  var fileCount = 0;
  
  var fileList = [];
  var renderFileList, sendFile;

  
  fileCatcher.addEventListener('submit', function (evnt) {
    evnt.preventDefault();
    fileList.forEach(function (file) {
        sendFile(file);
    });
  });
  
  fileInput.addEventListener('change', function (evnt) {
        fileList = [];
    for (var i = 0; i < fileInput.files.length; i++) {
        fileList.push(fileInput.files[i]);
    }
    renderFileList();
  });
  
  renderFileList = function () {
    fileListDisplay.innerHTML = '';
    pBar.value = 0;
    fileList.forEach(function (file, index) {
        var fileDisplayEl = document.createElement('p');
      //fileDisplayEl.innerHTML = (index + 1) + ': ' + file.name;
      fileListDisplay.appendChild(fileDisplayEl);
    });
  };

  sendFile = function (file) {
    var formData = new FormData();
    formData.set('file', file);
    formData.set('tag',  filetag.value);

    var xmlhttp  = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
            uploadButton.textContent = "Done"
            fileCount = fileCount + 1;
            var percent = (fileCount / fileList.length) * 100;
            pBar.value = Math.round(percent);
        }
    };
    xmlhttp.open("POST", 'http://localhost:4040/api/v1/upload');
    xmlhttp.send(formData);
  };
})();
</script>
</html>
